<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Recognition</title>
    <!-- Include necessary libraries -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
</head>
<body>
    <h1>Face Recognition</h1>
    <video id="video" width="100%" height="auto" playsinline></video>
    <canvas id="canvas" width="100%" height="auto"></canvas>

    <script>
        // Access the video element
        const video = document.getElementById('video');

        // Check if the browser supports the getUserMedia API
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } }) // 'user' for front camera, 'environment' for rear camera
                .then(function (stream) {
                    // Set the video source to the user's webcam
                    video.srcObject = stream;
                    return new Promise(resolve => video.onloadedmetadata = resolve);
                })
                .catch(function (error) {
                    console.error('Error accessing webcam:', error);
                });
        }

        // Wait for the video to be loaded and start face recognition
        video.addEventListener('loadeddata', function () {
            // Initialize FaceRecognition class
            const fr = new FaceRecognition();

            // Run face recognition on each video frame
            setInterval(async function () {
                const canvas = document.getElementById('canvas');
                const context = canvas.getContext('2d');
                context.drawImage(video, 0, 0, canvas.width, canvas.height);

                // Run face recognition on the canvas
                await fr.run_recognition(canvas);
            }, 100); // Adjust the interval based on your needs
        });

        // FaceRecognition class definition
        class FaceRecognition {
            constructor() {
                // Call the face encoding function to load known faces
                this.encode_faces();
            }

            encode_faces() {
                // Add your face encoding code here
                // You may need to use face-api.js for face recognition
            }

            async run_recognition(canvas) {
                // Resize the canvas for faster face recognition
                const smallCanvas = faceapi.createCanvasFromMedia(canvas);
                const displaySize = { width: canvas.width, height: canvas.height };
                faceapi.matchDimensions(smallCanvas, displaySize);

                // Run face recognition on the small canvas
                const detections = await faceapi.detectAllFaces(smallCanvas).withFaceLandmarks().withFaceDescriptors();
                
                // Add your face recognition code here
                // Compare detected faces with known faces and update the display

                // Example: Draw rectangles on the canvas for detected faces
                const resizedDetections = faceapi.resizeResults(detections, displaySize);
                const context = canvas.getContext('2d');
                context.clearRect(0, 0, canvas.width, canvas.height);
                faceapi.draw.drawDetections(canvas, resizedDetections);
            }
        }
    </script>
</body>
</html>
